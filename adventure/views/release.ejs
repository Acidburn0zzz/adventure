<%- include("head", {title: product.Name + " " + release.Name, sitePages: sitePages}) %>
<div class="row">
    <div class="col-sm-9">
        <h1><%= product.Name %> <small class="text-muted"><%= release.Name %></small></h1>
        <%- product.Notes %>
        <div id="releaseInformation">
            <nav id="releasesNav" aria-label="Releases navigation">
                <ul id="releasesList" class="nav nav-pills">
                    <% releases.forEach(function(i, n, a) {%>
                    <% if (i.ReleaseUUID.toString("hex") == release.ReleaseUUID.toString("hex")) { %>
                    <li class="nav-item">
                        <a class="nav-link active" href="/product/<%= product.Slug %>/<%= i.Slug %>">
                            <%= i.Name %> <span class="sr-only">(current)</span>
                        </a>
                    </li>
                    <% } else { %>
                    <li class="nav-item">
                        <a class="nav-link" href="/product/<%= product.Slug %>/<%= i.Slug %>"><%= i.Name %></a>
                    </li>
                    <% } %>
                    <% }); %>
                </ul>
            </nav>
            <% if (screenshots && screenshots.length > 0) { %>
            <div id="screenshotPanel" class="carousel slide lazy mb-2 mt-2 w-75 mx-auto" data-ride="carousel">
                <ol class="carousel-indicators">
                    <% screenshots.forEach(function (i, n, a) { %>
                    <li data-target="#screenshotPanel" data-slide-to="<%= n %>" class="<%= n ? '' : 'active' %>"></li>
                    <% }); %>
                </ol>
                <div class="carousel-inner">
                    <% screenshots.forEach(function (i, n, a) { %>
                    <div class="carousel-item <%= n ? '' : 'active' %>">
                        <%# Lazy load images %>
                        <a href="<%= i.ScreenshotFile %>">
                            <%# Carousel captions suck a bit IMHO, so just embrace the hovertext %>
                            <img class="d-block w-100" <%= n ? 'data-src' : 'src' %>="<%= i.ScreenshotFile %>" alt="<%= i.ScreenshotTitle %>" title="<%= i.ScreenshotTitle %>">
                        </a>
                    </div>
                    <% }); %>
                    <!-- TODO: Truncate, link to page with more... -->
                </div>
                <a class="carousel-control-prev" href="#screenshotPanel" role="button" data-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="sr-only">Previous</span>
                </a>
                <a class="carousel-control-next" href="#screenshotPanel" role="button" data-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="sr-only">Next</span>
                </a>
            </div>
            <% } %>
            <%- release.Notes %>
            <% if (release.InstallInstructions) { %>
            <h3>Installation instructions</h3>
            <%- release.InstallInstructions %>
            <% } %>
            <h3>Downloads</h3>
            <table id="downloadsTable" class="table table-striped table-sm">
                <thead>
                    <tr>
                        <th>Download Name</th>
                        <th>Version</th>
                        <th>Language</th>
                        <th><abbr title="Processor architecture">CPU</abbr></th>
                        <th>File type</th>
                        <th>File size</th>
                    </tr>
                </thead>
                <tbody>
                    <% (downloads || []).forEach(function(i, n, a) {%>
                    <tr>
                        <td><a href="/download/<%= i.DLUUID.toString('hex') %>"><%= i.Name %></a></td>
                        <td>
                            <%= i.Version %>
                            <span class="downloadTagPrerelease badge badge-warning"><%= i.RTM == "True" ? "" : "Prerelease" %></span>
                            <span class="downloadTagUpgrade badge badge-secondary"><%= i.Upgrade == "True" ? "Upgrade" : "" %></span>
                        </td>
                        <td><%= i.Language %></td>
                        <td><%= i.Arch %></td>
                        <td><%= i.ImageType %></td>
                        <td><span title="<%= i.SHA1Sum.toString('hex') %>"><%= i.FileSize %></span></td>
                    </tr>
                    <% }); %>
                </tbody>
            </table>
        </div>
    </div>
    <div class="col-sm">
        <div id="infoSheet" class="card mb-3">
            <div class="card-header" role="tab" id="infoSheetHeader">
                <h2 class="mb-0 h6">
                    Information
                </h2>
            </div>
            <dl id="infoSheetBody" class="card-body" role="tabpanel" aria-labelledby="infoSheetHeader">
                <dt>Product type</dt>
                <dd>
                    <%
                    var typeLink = "";
                    switch (product.Type) {
                    case "OS":
                    typeLink = "operating-systems";
                    break;
                    case "System":
                    typeLink = "sys";
                    break;
                    case "Game":
                    typeLink = "games";
                    break;
                    case "DevTool":
                    typeLink = "dev";
                    break;
                    case "Application":
                    typeLink = "applications";
                    break;
                    }
                    %>
                    <a href="/library/<%= typeLink %>"><%= product.Type %></a>
                    <% if (product.Type == "Application" && product.ApplicationTags) { %>
                    (<%= product.ApplicationTags.split(",").join(", ") %>)
                    <% } %>
                </dd>

                <% if (release.VendorName) { %>
                <dt>Vendor</dt>
                <dd><%= release.VendorName %></dd>
                <% } %>
                <!-- TODO: Should fuzzy date-->
                <% if (release.ReleaseDate.getTime()) { %>
                <dt>Release date</dt>
                <dd><%= release.FuzzyDate ? release.ReleaseDate.getFullYear() : release.ReleaseDate.toDateString() %></dd>
                <% } %>
                <% if (release.EndOfLife.getTime()) { %>
                <dt>End of life date</dt>
                <dd><%= release.FuzzyDate ? release.EndOfLife.getFullYear() : release.EndOfLife.toDateString() %></dd>
                <% } %>
                <% if (release.CPURequirement) { %>
                <dt>Minimum CPU</dt>
                <dd><%= release.CPURequirement %></dd>
                <% } %>
                <% if (release.RAMRequirement && release.RAMRequirement != "0") { %>
                <dt>Minimum RAM</dt>
                <dd><%= release.RAMRequirement %></dd>
                <% } %>
                <% if (release.DiskSpaceRequired && release.DiskSpaceRequired != "0") { %>
                <dt>Minimum free disk space</dt>
                <dd><%= release.DiskSpaceRequired %></dd>
                <% } %>
                <% if (release.Type) { %>
                <dt>User interface</dt>
                <dd><%= release.Type %></dd>
                <% } %>
                <% if (release.Platform) { %>
                <dt>Platform</dt>
                <dd>
                    <%= release.Platform.split(",").join(", ") %>
                </dd>
                <% } %>
            </dl>
        </div>
        <% if (serials && serials.length) { %>
        <div id="serialSheet" class="card">
            <div class="card-header" role="tab" id="serialSheetHeader">
                <h2 class="mb-0 h6">
                    Serials
                </h2>
            </div>
            <ul id="serialsList" class="card-body ml-3" role="tabpanel" aria-labelledby="serialSheetHeader">
                <% serials.forEach(function(i, n, a) {%>
                <li><%= i.Serial %></li>
                <% }); %>
            </ul>
        </div>
        <% } %>
    </div>
</div>
<%- include("foot") %>